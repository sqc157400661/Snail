# 找房项目重构方案总结

## 项目简介

本次介绍的项目是我老东家**自如租房**的房源详情页服务的重构项目。详情页是用户发生购买行为的最重要的一个页面，详情页的体验直接影响到用户购买行为。是一个举足轻重的页面，所以我们将详情页做成了一个独立的BFF服务。

> BFF ： Backend For Frontend（服务于前端的后端）

<!--网上有很多黑自如的，但是作为一个曾经在自如工作的自如人，个人觉得自如属于良心公司，对用户和客户服务理念和管理都是我目前遇到的最好的-->

## 项目背景

自如里有一句话：**品质就是生命**。把产品做到极致，是从上到下的要求，也是出于这个，我们开始了对详情页现状的盘点：

1. 详情页的响应时间TP95:505ms,最大可达1s+，毛刺较多。
2. 平时运行消耗资源过多，cpu：32， mem：32G，2pod副本，消耗CPU：平均25.15%，峰值71%，消耗内存：平均30.89%，峰值56%
3. 错误率和超时率：0.1%



## 项目目标

1. 详情页的响应时间TP95：100ms内，消除毛刺
2. 运行物理资源节省50%
3. 错误率和超时率降低到0.01%
4. 争取获取公司级最佳质量奖

## 技术方案设计

讲技术方案前，咱们先看一下原始的实现方式和技术组成：

### 原始项目架构：

#### 技术组成：

1. PHP做业务代码
2. Solr做企业级搜索，数据包括小区、舍友信息
3. Redis做缓存
4. 基于ZK实现的配置数据和降级数据
5. 传统的虚拟机进行部署

#### 技术方案：

![1621846440004](D:\www\Snail\Go实战系列\images\1621846440004.png)



![1621847373599](D:\www\Snail\Go实战系列\images\1621847373599.png)

- 服务历史债务严重
- 依赖服务串行化调用严重
- 业务与业务直接依赖严重，牵一发而动全身，间接导致接口错误率比较高

------

下面咱们详细开始讲述我们整体的重构方案：

```
.
├── api
├── cmd
│   └── app
├── config
├── internal
│   ├── domain
│   ├── repo
│   ├── service
│   └── usecase
└── pkg
```



## 复盘

## 总结和洞察